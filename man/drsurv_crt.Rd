% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/drsurv_crt.R
\name{drsurv_crt}
\alias{drsurv_crt}
\title{Doubly Robust Survival Analysis for Cluster-Randomized Trials}
\usage{
drsurv_crt(
  s_formula,
  c_formula,
  trt,
  probs,
  estimand = "rmst",
  scale = "RD",
  method = "marginal",
  res_time,
  data,
  id
)
}
\arguments{
\item{s_formula}{A formula specifying the survival outcome model (e.g., `Surv(time, event) ~ covariates`).}

\item{c_formula}{A formula specifying the censoring model (e.g., `Surv(time, event) ~ covariates + cluster(id)`).}

\item{trt}{A string indicating the treatment variable in `data`. The variable must be binary (`0/1`).}

\item{probs}{A numeric vector of length 2, specifying the treatment probabilities (`P(trt=1)`, `P(trt=0)`) in the CRT.}

\item{estimand}{A string indicating the estimand of interest. Options:
- `"rmst"`: Restricted Mean Survival Time (default).
- `"surv"`: Survival probability at specified time points (`res_time`).}

\item{scale}{A string specifying the scale of effect estimation:
- `"RD"`: Risk Difference (default).
- `"RR"`: Risk Ratio.}

\item{method}{A string indicating the estimation method:
- `"marginal"`: Marginal Cox model (default).
- `"frailty"`: Frailty Cox model.}

\item{res_time}{A numeric vector specifying the time points for estimation.}

\item{data}{A data frame containing the survival data for analysis.}

\item{id}{A string specifying the cluster/group ID variable in `data`.}
}
\value{
A list with two elements:
  - `s_c`: A data frame containing **cluster-level survival estimates** for each time point in `res_time`.
  - `s_i`: A data frame containing **individual-level survival estimates** for each time point in `res_time`.
}
\description{
This function estimates survival probabilities in cluster-randomized trials (CRTs)
using doubly robust estimation. It supports both restricted mean survival time (RMST)
and survival probability estimation. The function allows specifying marginal or frailty
models for the estimation.
}
\examples{
\dontrun{
# Load example data
data(ex_dt)  # Data is loaded into `ex_dt`

# Compute cluster sizes and treatment probabilities
sum_N <- ex_dt \%>\%
  group_by(M) \%>\%
  summarise(n())

ex_dt$Ni <- rep(sum_N$`n()`, sum_N$`n()`)

prop <- ex_dt \%>\%
  group_by(.data[["M"]]) \%>\%
  slice(1) \%>\%  # Extract first observation per cluster
  ungroup() \%>\%
  summarize(
    prop1 = mean(.data[["A"]] == 1),
    prop0 = mean(.data[["A"]] == 0)
  ) \%>\% as.data.frame()

probs <- c(prop$prop1, prop$prop0)

# Define survival and censoring models
s_formula <- Surv(obs_T,Delta) ~ Z1 + Z2 + W1 + W2 + Ni + cluster(M)
c_formula <- Surv(obs_T,Delta) ~ Z1 + Z2 + W1 + W2 + cluster(M)

# Run doubly robust survival estimation
results <- drsurv_crt(
  s_formula = s_formula,
  c_formula = c_formula,
  trt = "A",
  probs = probs,
  estimand = "rmst",
  scale = "RD",
  method = "marginal",
  res_time = c(0.1, 0.5, 1, 1.5),  # Example time points
  data = ex_dt,
  id = "id"
)

# View results
print(results$s_c)
print(results$s_i)
}

}
